<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart - Robotics Lab</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="cart.css">
<style>
  /* Mejoras estéticas rápidas */
  body { font-family: Arial, sans-serif; background: #f9f9f9; color: #333; margin:0; }
  .cart-header { display: flex; justify-content: space-between; align-items: center; background: #0057b7; color: white; padding: 1rem; }
  .logo { height: 50px; margin-right: 1rem; }
  .btn-back { background: white; color: #0057b7; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
  .cart-main { max-width: 900px; margin: 2rem auto; padding: 1rem; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  .cart-items-section, .checkout-section { margin-bottom: 2rem; }
  .cart-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding: 0.5rem 0; }
  .cart-item-info { display: flex; flex-direction: column; }
  .cart-item button { background: #ff4c4c; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; }
  .checkout-form label { display: block; margin: 0.5rem 0; }
  .btn-submit { background: #0057b7; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; margin-top: 1rem; }
</style>
</head>
<body>
<header class="cart-header">
  <div class="logo-title">
    <img src="img/15.jpg" alt="Robotics Lab Logo" class="logo">
    <h1>Your Cart</h1>
  </div>
  <button class="btn-back" onclick="window.location.href='catalogo.html'">Back to Catalog</button>
</header>

<main class="cart-main">
  <section class="cart-items-section">
    <h2>Products in Cart</h2>
    <div id="cart-items" class="cart-items"></div>
  </section>

  <section class="checkout-section">
    <h2>Contact Information</h2>
    <form id="checkout-form" class="checkout-form">
      <label>
        Name: <input type="text" name="name" placeholder="Your full name" required>
      </label>
      <label>
        Email: <input type="email" name="email" placeholder="example@mail.com" required>
      </label>
      <button type="submit" class="btn-submit">Submit Order</button>
    </form>
  </section>
</main>

<script type="module">
// Mostrar carrito
const cartItemsDiv = document.getElementById("cart-items");
let cart = JSON.parse(localStorage.getItem("cart")) || [];

// Función para renderizar productos en el carrito
function renderCart() {
  cartItemsDiv.innerHTML = '';
  cart.forEach((item, index) => {
    const div = document.createElement("div");
    div.classList.add("cart-item");
    div.innerHTML = `
      <div class="cart-item-info">
        <strong>${item.name}</strong>
        <span>Price: $${item.price}</span>
        <span>Quantity: ${item.quantity}</span>
      </div>
      <button data-index="${index}">Remove</button>
    `;
    cartItemsDiv.appendChild(div);
  });

  // Botón eliminar
  document.querySelectorAll(".cart-item button").forEach(btn => {
    btn.addEventListener("click", e => {
      const i = e.target.dataset.index;
      cart.splice(i, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    });
  });
}

renderCart();

// Enviar pedido al API de orders
document.getElementById("checkout-form").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const name = formData.get("name");
  const email = formData.get("email");

  if (cart.length === 0) {
    alert("❌ Your cart is empty!");
    return;
  }

  try {
    // Enviar cada producto como orden individual
    for (const item of cart) {
      const res = await fetch("https://sanj3d-store.onrender.com/api/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          product: item.id,   // ID correcto
          quantity: item.quantity
        })
      });

      if (!res.ok) {
        const data = await res.json();
        throw new Error(data.error || "Unknown error");
      }
    }

    alert("✅ All orders submitted successfully!");
    localStorage.removeItem("cart");
    window.location.href = "index.html";

  } catch (err) {
    alert(`❌ Error: ${err.message}`);
  }
});
</script>
</body>
</html>
