<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart - Robotics Lab</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>Your Cart</h1>
  <button onclick="window.location.href='catalogo.html'">Back to Catalog</button>
</header>

<main>
  <div id="cart-items"></div>

  <h2>Contact Information</h2>
  <form id="checkout-form">
    <label>Name: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <button type="submit">Submit Order</button>
  </form>
</main>

<script type="module">
const cartItemsDiv = document.getElementById("cart-items");
const cart = JSON.parse(localStorage.getItem("cart")) || [];

// Mostrar los productos en el carrito
cart.forEach(item => {
  const div = document.createElement("div");
  div.innerHTML = `${item.name} - $${item.price} x ${item.quantity}`;
  cartItemsDiv.appendChild(div);
});

// Enviar pedido al API de orders
document.getElementById("checkout-form").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);

  const order = {
    name: formData.get("name"),
    email: formData.get("email"),
    products: cart.map(item => ({
      productId: item.id, // asegúrate de guardar el id del producto al agregar al carrito
      name: item.name,
      quantity: item.quantity,
      price: item.price
    }))
  };

  try {
    const res = await fetch("https://sanj3d-store.onrender.com/api/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(order)
    });

    const data = await res.json();

    if (res.ok) {
      alert("✅ Order submitted successfully!");
      localStorage.removeItem("cart");
      window.location.href = "index.html";
    } else {
      alert(`❌ Error: ${data.error}`);
    }
  } catch (err) {
    alert(`❌ Connection error: ${err.message}`);
  }
});
</script>
</body>
</html>
