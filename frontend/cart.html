<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart - Robotics Lab</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>Your Cart</h1>
  <button onclick="window.location.href='catalogo.html'">Back to Catalog</button>
</header>

<main>
  <div id="cart-items"></div>

  <h2>Contact Information</h2>
  <form id="checkout-form">
    <label>Name: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <button type="submit">Submit Order</button>
  </form>
</main>

<script type="module">
const cartItemsDiv = document.getElementById("cart-items");
const cart = JSON.parse(localStorage.getItem("cart")) || [];

// Mostrar los productos en el carrito
cart.forEach(item => {
  const div = document.createElement("div");
  div.innerHTML = `${item.name} - $${item.price} x ${item.quantity}`;
  cartItemsDiv.appendChild(div);
});

// Enviar cada producto al API de orders
document.getElementById("checkout-form").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const name = formData.get("name");
  const email = formData.get("email");

  if (cart.length === 0) {
    alert("❌ Your cart is empty!");
    return;
  }

  try {
    for (const item of cart) {
      const res = await fetch("https://sanj3d-store.onrender.com/api/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          product: item.name,
          quantity: item.quantity
        })
      });

      if (!res.ok) {
        const data = await res.json();
        throw new Error(data.error || "Unknown error");
      }
    }

    alert("✅ All orders submitted successfully!");
    localStorage.removeItem("cart");
    window.location.href = "index.html";

  } catch (err) {
    alert(`❌ Error: ${err.message}`);
  }
});
</script>
</body>
</html>
