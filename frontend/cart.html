<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart - Robotics Lab</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="cart.css">
</head>
<body>
<header class="cart-header">
  <div class="logo-title">
    <img src="img/15.jpg" alt="Robotics Lab Logo" class="logo">
    <h1>Your Cart</h1>
  </div>
  <button class="btn-back" onclick="window.location.href='catalogo.html'">Back to Catalog</button>
</header>

<main class="cart-main">
  <section class="cart-items-section">
    <h2>Products in Cart</h2>
    <div id="cart-items" class="cart-items"></div>
  </section>

  <section class="checkout-section">
    <h2>Contact Information</h2>
    <form id="checkout-form" class="checkout-form">
      <label>
        Name: <input type="text" name="name" placeholder="Your full name" required>
      </label>
      <label>
        Email: <input type="email" name="email" placeholder="example@mail.com" required>
      </label>
      <button type="submit" class="btn-submit">Submit Order</button>
    </form>
  </section>
</main>

<script type="module">
// Obtener elementos
const cartItemsDiv = document.getElementById("cart-items");
const cart = JSON.parse(localStorage.getItem("cart")) || [];

// Mostrar productos con estilo
cart.forEach(item => {
  const div = document.createElement("div");
  div.classList.add("cart-item");
  div.innerHTML = `
    <div class="cart-item-info">
      <strong>${item.name}</strong>
      <span>Price: $${item.price}</span>
      <span>Quantity: ${item.quantity}</span>
    </div>
  `;
  cartItemsDiv.appendChild(div);
});

// Enviar pedido al API de orders
document.getElementById("checkout-form").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const name = formData.get("name");
  const email = formData.get("email");

  if (cart.length === 0) {
    alert("❌ Your cart is empty!");
    return;
  }

  try {
    // Enviar cada producto como orden individual
    for (const item of cart) {
      const res = await fetch("https://sanj3d-store.onrender.com/api/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          product: item.id,      // ID del producto desde el carrito
          quantity: item.quantity
        })
      });

      if (!res.ok) {
        const data = await res.json();
        throw new Error(data.error || "Unknown error");
      }
    }

    alert("✅ All orders submitted successfully!");
    localStorage.removeItem("cart");
    window.location.href = "index.html";

  } catch (err) {
    alert(`❌ Error: ${err.message}`);
  }
});
</script>
</body>
</html>
